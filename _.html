<head>
  <title>freak flag</title>

  <link href="//cdnjs.cloudflare.com/ajax/libs/select2/4.0.0-rc.1/css/select2.min.css" rel="stylesheet" />
  <script src="//cdnjs.cloudflare.com/ajax/libs/select2/4.0.0-rc.1/js/select2.min.js"></script>

  <link rel="icon" type="image/png" href="/logo.png">

</head>

<template name="layout">

 <h1>
   <a href="/">
    <img id="logo" src="/logo.png">
    freak flag
   </a>
  </h1>
 {{> loginButtons}}

 {{#if currentUser}}
  <ul>
    <li>
      <a href="/users"> users </a>
    </li>
    <li>
      <a href="/relations"> relations </a>
    </li>
    <li>
      <a href="/badges"> badges </a>
    </li>
    <li>
      <a href="/patches"> patches </a>
    </li>
  </ul>
  {{>Template.dynamic template=content}}
 {{/if}}
</template>

<template name="main">
  <h2>Welcome!</h2>
  <h3> My status </h3>
  <h3> My relations </h3>
  <ul>
    {{#each relations}}
      <li>
        <a href="{{relationLink}}"> {{displayName}} </a>
      </li>
    {{/each}}
  </ul>

  <h3> My badges </h3>
  <ul>
    {{#each badges}}
      <li>
        {{displayName}}
      </li>
    {{/each}}
  </ul>
  <h3> My patches </h3>

</template>

<template name="users">
  <h2>Users</h2>
  <ul>
    {{#each users}}
      <li>
        {{_id}}, {{email}}
      </li>
    {{/each}}
  </ul>
</template>

<template name="relations">
 <h2> Relations </h2>
 <p> Relations are used to group 2 or more users </p>

 <h3>existing relations</h3>
 <ul>
   {{#each relations}}
     <li> <a href="{{relationLink}}"> {{displayName}} </a> </li>
   {{/each}}
 </ul>

 <h3> New relation </h3>
 {{> quickForm collection="Relations" id="insertRelationForm" type="insert"}}

</template>

<template name="relationChunk">
  <div class="well">
    <a href="{{link}}"> {{link}} </a>
    {{> quickForm collection="Relations" id=formId type="update" doc=this}}
  </div>
</template>

<template name="relationPage">
  {{#with relation}}
    <h2> {{displayName}}  </h2>
    {{> relationChunk}}

    <ul>
     {{#each knots}}
       <li>
         #{{_id}} - {{creatorName}} said:
         <p class="well">
          {{body}}

          <ul>
            {{#each claim}}
              <li>
                 <b>{{claimaintName}}</b> claimed <b>{{patchName}}</b>
              </li>
            {{/each}}
          </ul>

         </p>
       </li>
     {{/each}}
    </ul>

    {{#autoForm id="insertKnotForm" type="method" meteormethod="knots.insert" schema=insertKnotFormSchema doc=preKnot}}
      {{> afQuickField name='body' rows=5}}
      {{> afQuickField name='claim' }}
      {{> afQuickField name='relationId' type="hidden"}}
      {{> afQuickField name='createdAt' type="hidden"}}
      {{> afQuickField name='createdBy' type="hidden"}}
      <button type="submit" class="btn btn-primary">Post to thread</button>
    {{/autoForm}}

  {{/with}}
</template>

<template name="badges">
 <h2> Badges </h2>
 <p> Badges exist in limited quantities and can only be assigned to user's by an admin.  </p>
 <ul>
   {{#each badges}}
     <li>
       <h3>{{_id}}</h3>
       {{> quickForm collection="Badges" id=formId type="update" doc=this}}
     </li>
   {{/each}}
 </ul>
 {{> quickForm collection="Badges" id="insertBadgeForm" type="insert"}}
</template>

<template name="patches">
 <h2> Patches </h2>
 <p> Patches can be claimed by an user. </p>
 <ul>
   {{#each patches}}
     <li>
       <h3>{{_id}}</h3>
       {{> quickForm collection="Patches" id=formId type="update" doc=this}}
     </li>
   {{/each}}
 </ul>
 {{> quickForm collection="Patches" id="insertPatchForm" type="insert"}}
</template>
